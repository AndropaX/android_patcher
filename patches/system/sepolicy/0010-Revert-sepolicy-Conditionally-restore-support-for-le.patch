From 72c00de7eb2b7cfb0c424badefb817522e8ed5d1 Mon Sep 17 00:00:00 2001
From: LuK1337 <priv.luk@gmail.com>
Date: Wed, 21 Feb 2018 03:27:51 +0100
Subject: [PATCH 10/11] Revert "sepolicy: Conditionally restore support for
 legacy f_adb interface"

This reverts commit 32f56ee0e05d0ff727e5589f955ef4743802f892.
---
 definitions.mk        | 1 -
 private/adbd.te       | 6 +-----
 private/file_contexts | 1 -
 public/device.te      | 1 -
 public/recovery.te    | 6 +-----
 5 files changed, 2 insertions(+), 13 deletions(-)

diff --git a/definitions.mk b/definitions.mk
index ab577cca..1af4c14b 100644
--- a/definitions.mk
+++ b/definitions.mk
@@ -10,7 +10,6 @@ $(hide) m4 $(PRIVATE_ADDITIONAL_M4DEFS) \
 	-D target_with_asan=$(PRIVATE_TGT_WITH_ASAN) \
 	-D target_full_treble=$(PRIVATE_FULL_TREBLE) \
 	-D target_needs_platform_text_relocations=$(TARGET_NEEDS_PLATFORM_TEXT_RELOCATIONS) \
-	-D target_uses_legacy_adb_interface=$(TARGET_USES_LEGACY_ADB_INTERFACE) \
 	$(PRIVATE_TGT_RECOVERY) \
 	-s $^ > $@
 endef
diff --git a/private/adbd.te b/private/adbd.te
index 1f417f6c..47a6cbd8 100644
--- a/private/adbd.te
+++ b/private/adbd.te
@@ -25,11 +25,7 @@ allow adbd self:capability setpcap;
 # Create and use network sockets.
 net_domain(adbd)
 
-# Access /dev/android_adb or /dev/usb-ffs/adb/ep0
-ifelse(target_uses_legacy_adb_interface, `true',
-  allow adbd adb_device:chr_file rw_file_perms;
-,
-)
+# Access /dev/usb-ffs/adb/ep0
 allow adbd functionfs:dir search;
 allow adbd functionfs:file rw_file_perms;
 
diff --git a/private/file_contexts b/private/file_contexts
index b59a1ed5..c50994fd 100644
--- a/private/file_contexts
+++ b/private/file_contexts
@@ -65,7 +65,6 @@
 /dev/adf-interface[0-9]*\.[0-9]*	u:object_r:graphics_device:s0
 /dev/adf-overlay-engine[0-9]*\.[0-9]*	u:object_r:graphics_device:s0
 /dev/alarm		u:object_r:alarm_device:s0
-/dev/android_adb.*	u:object_r:adb_device:s0
 /dev/ashmem		u:object_r:ashmem_device:s0
 /dev/audio.*		u:object_r:audio_device:s0
 /dev/binder		u:object_r:binder_device:s0
diff --git a/public/device.te b/public/device.te
index c921a20b..475948da 100644
--- a/public/device.te
+++ b/public/device.te
@@ -1,7 +1,6 @@
 # Device types
 type device, dev_type, fs_type;
 type alarm_device, dev_type, mlstrustedobject;
-type adb_device, dev_type;
 type ashmem_device, dev_type, mlstrustedobject;
 type audio_device, dev_type;
 type audio_timer_device, dev_type;
diff --git a/public/recovery.te b/public/recovery.te
index 3f277c3d..fe0b20e4 100644
--- a/public/recovery.te
+++ b/public/recovery.te
@@ -73,11 +73,7 @@ recovery_only(`
 
   allow recovery kernel:system syslog_read;
 
-  # Access /dev/android_adb or /dev/usb-ffs/adb/ep0
-  ifelse(target_uses_legacy_adb_interface, `true',
-    allow recovery adb_device:chr_file rw_file_perms;
-  ,
-  )
+  # Access /dev/usb-ffs/adb/ep0
   allow recovery functionfs:dir search;
   allow recovery functionfs:file rw_file_perms;
 
-- 
2.13.1

