From 0501e634679e5bd5c5f854ab3feaa490e29c42db Mon Sep 17 00:00:00 2001
From: LuK1337 <priv.luk@gmail.com>
Date: Wed, 21 Feb 2018 10:33:51 +0100
Subject: [PATCH] oh no

Change-Id: I0c4dc5f83e37553590ef911dc8a154b1c68d2758
---
 common/private/genfs_contexts |  3 ---
 common/private/su.te          | 12 ---------
 common/private/vold.te        |  2 +-
 common/public/su.te           | 63 -------------------------------------------
 4 files changed, 1 insertion(+), 79 deletions(-)
 delete mode 100644 common/private/genfs_contexts
 delete mode 100644 common/private/su.te
 delete mode 100644 common/public/su.te

diff --git a/common/private/genfs_contexts b/common/private/genfs_contexts
deleted file mode 100644
index ae77a83..0000000
--- a/common/private/genfs_contexts
+++ /dev/null
@@ -1,3 +0,0 @@
-genfscon exfat / u:object_r:exfat:s0
-genfscon fuseblk / u:object_r:fuseblk:s0
-genfscon ntfs / u:object_r:ntfs:s0
diff --git a/common/private/su.te b/common/private/su.te
deleted file mode 100644
index bd19cff..0000000
--- a/common/private/su.te
+++ /dev/null
@@ -1,12 +0,0 @@
-userdebug_or_eng(`
-  typeattribute sudaemon coredomain;
-
-  domain_trans(init, su_exec, sudaemon)
-
-  type_transition sudaemon socket_device:sock_file superuser_device;
-
-  # sudaemon is also permissive to permit setenforce.
-  permissive sudaemon;
-
-  app_domain(sudaemon)
-')
diff --git a/common/private/vold.te b/common/private/vold.te
index b25f25a..a7cf5f9 100644
--- a/common/private/vold.te
+++ b/common/private/vold.te
@@ -1,5 +1,5 @@
 # Allow vold to access fuse for fuse-based fs
-allow vold fuseblk:chr_file rw_file_perms;
+# allow vold fuseblk:chr_file rw_file_perms;
 
 # NTFS-3g wants to drop permission
 allow vold self:capability { setgid setuid };
diff --git a/common/public/su.te b/common/public/su.te
deleted file mode 100644
index 46d1197..0000000
--- a/common/public/su.te
+++ /dev/null
@@ -1,63 +0,0 @@
-type superuser_device, file_type, mlstrustedobject;
-
-## Perms for the daemon
-
-userdebug_or_eng(`
-  typeattribute sudaemon domain, mlstrustedsubject;
-
-  # The userspace app uses /dev sockets to control per-app access
-  allow sudaemon superuser_device:dir { create rw_dir_perms setattr unlink };
-  allow sudaemon superuser_device:sock_file { create setattr unlink write };
-
-  # Add sudaemon to various domains
-  net_domain(sudaemon)
-
-  dontaudit sudaemon self:capability_class_set *;
-  dontaudit sudaemon kernel:security *;
-  dontaudit sudaemon kernel:system *;
-  dontaudit sudaemon self:memprotect *;
-  dontaudit sudaemon domain:process *;
-  dontaudit sudaemon domain:fd *;
-  dontaudit sudaemon domain:dir *;
-  dontaudit sudaemon domain:lnk_file *;
-  dontaudit sudaemon domain:{ fifo_file file } *;
-  dontaudit sudaemon domain:socket_class_set *;
-  dontaudit sudaemon domain:ipc_class_set *;
-  dontaudit sudaemon domain:key *;
-  dontaudit sudaemon fs_type:filesystem *;
-  dontaudit sudaemon {fs_type dev_type file_type}:dir_file_class_set *;
-  dontaudit sudaemon node_type:node *;
-  dontaudit sudaemon node_type:{ tcp_socket udp_socket rawip_socket } *;
-  dontaudit sudaemon netif_type:netif *;
-  dontaudit sudaemon port_type:socket_class_set *;
-  dontaudit sudaemon port_type:{ tcp_socket dccp_socket } *;
-  dontaudit sudaemon domain:peer *;
-  dontaudit sudaemon domain:binder *;
-  dontaudit sudaemon property_type:property_service *;
-  dontaudit sudaemon appops_service:service_manager *;
-')
-
-## Perms for the app
-
-userdebug_or_eng(`
-  # Translate user apps to the shell domain when using su
-  #
-  # PR_SET_NO_NEW_PRIVS blocks this :(
-  # we need to find a way to narrow this down to the actual exec.
-  # typealias shell alias suclient;
-  # domain_auto_trans(untrusted_app, su_exec, suclient)
-
-  allow untrusted_app_all su_exec:file { execute_no_trans getattr open read execute };
-  allow untrusted_app_all sudaemon:unix_stream_socket { connectto read write setopt ioctl };
-  allow untrusted_app_all superuser_device:dir { r_dir_perms };
-  allow untrusted_app_all superuser_device:sock_file { write };
-
-  # For Settings control of access
-  allow system_app superuser_device:sock_file { read write create setattr unlink getattr };
-  allow system_app sudaemon:unix_stream_socket { connectto read write setopt ioctl };
-  allow system_app superuser_device:dir { create rw_dir_perms setattr unlink };
-
-  allow kernel sudaemon:fd { use };
-')
-
-neverallow { domain userdebug_or_eng(`-dumpstate -shell -su -untrusted_app_all -init -sudaemon') } su_exec:file no_x_file_perms;
-- 
2.13.1

